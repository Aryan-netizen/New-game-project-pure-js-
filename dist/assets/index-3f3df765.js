var D=Object.defineProperty;var I=(i,e,t)=>e in i?D(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var R=(i,e,t)=>(I(i,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}})();class F{constructor(e,t){R(this,"mainLoop",e=>{if(!this.isRunning)return;let t=e-this.lastFrameTime;for(this.lastFrameTime=e,this.accumulatedTime+=t;this.accumulatedTime>=this.timeStep;)this.update(this.timeStep),this.accumulatedTime-=this.timeStep;this.render(),this.rafId=requestAnimationFrame(this.mainLoop)});this.lastFrameTime=0,this.accumulatedTime=0,this.timeStep=1e3/60,this.update=e,this.render=t,this.rafId=null,this.isRunning=!1}start(){this.isRunning||(this.isRunning=!0,this.lastFrameTime=performance.now(),this.rafId=requestAnimationFrame(this.mainLoop))}stop(){this.isRunning&&cancelAnimationFrame(this.rafId),this.isRunning=!1}}class O{constructor(){this.toload={hero:"sprites/hero-sheet.png",sprite:"sprites/spritesheet.png",sky:"sprites/sky.png",ground:"sprites/ground.png",rod:"sprites/rod.png",shadow:"sprites/shadow.png"},this.images={},Object.keys(this.toload).forEach(e=>{const t=new Image;t.src=this.toload[e],this.images[e]={image:t,isLoaded:!1},t.onload=()=>{this.images[e].isLoaded=!0}})}}const L=new O;class c{constructor(e=0,t=0){this.x=e,this.y=t}duplicate(){return new c(this.x,this.y)}}class S{constructor({resource:e,frameSize:t,hframe:n,vframe:s,frame:r,scale:o,position:m,animations:w}){this.resource=e,this.frameSize=t??new c(16,16),this.hframe=n??1,this.vframe=s??1,this.frame=r??0,this.frameMap=new Map,this.scale=o??1,this.position=m??new c(0,0),this.buildFrameMap(),this.animations=w??null}buildFrameMap(){let e=0;for(let t=0;t<this.vframe;t++)for(let n=0;n<this.hframe;n++)this.frameMap.set(e,new c(this.frameSize.x*n,this.frameSize.y*t)),e++}step(e){this.animations&&(this.animations.step(e),this.frame=this.animations.frame)}drawImage(e,t,n){if(!this.resource.isLoaded)return;let s=0,r=0;const o=this.frameMap.get(this.frame);o&&(s=o.x,r=o.y);const m=this.frameSize.x,w=this.frameSize.y;e.drawImage(this.resource.image,s,r,m,w,t,n,m*this.scale,w*this.scale)}}const p="DOWN",y="LEFT",A="RIGHT",T="UP";class z{constructor(){this.helpDirection=[],document.addEventListener("keydown",e=>{(e.code==="ArrowUp"||e.code==="KeyW")&&this.onArrowPressed(T),(e.code==="ArrowDown"||e.code==="KeyS")&&this.onArrowPressed(p),(e.code==="ArrowLeft"||e.code==="KeyA")&&this.onArrowPressed(y),(e.code==="ArrowRight"||e.code==="KeyD")&&this.onArrowPressed(A)}),document.addEventListener("keyup",e=>{(e.code==="ArrowUp"||e.code==="KeyW")&&this.onArrowReleased(T),(e.code==="ArrowDown"||e.code==="KeyS")&&this.onArrowReleased(p),(e.code==="ArrowLeft"||e.code==="KeyA")&&this.onArrowReleased(y),(e.code==="ArrowRight"||e.code==="KeyD")&&this.onArrowReleased(A)})}get direction(){return this.helpDirection[0]}onArrowPressed(e){this.helpDirection.indexOf(e)===-1&&this.helpDirection.unshift(e)}onArrowReleased(e){const t=this.helpDirection.indexOf(e);t!==-1&&this.helpDirection.splice(t,1)}}const K=i=>i*16,W=(i,e,t)=>{const n=`${e},${t}`;return!i.has(n)};function N(i,e,t){let n=e.x-i.position.x,s=e.y-i.position.y,r=Math.sqrt(n**2+s**2);if(r<=t)i.position.x=e.x,i.position.y=e.y;else{let o=n/r,m=s/r;i.position.x+=t*o,i.position.y+=t*m,n=e.x-i.position.x,s=e.y-i.position.y,r=Math.sqrt(n**2+s**2)}return r}const d=new Set;d.add("64,48");d.add("64,64");d.add("64,80");d.add("80,64");d.add("80,80");d.add("112,80");d.add("128,80");d.add("144,80");d.add("160,80");class h{constructor(e){this.currentTime=0,this.animationConfig=e,this.duration=e.duration??500}get frame(){const{frames:e}=this.animationConfig;for(let t=e.length-1;t>=0;t--)if(this.currentTime>=e[t].time)return e[t].frame;throw"Time is before the frame"}step(e){this.currentTime+=e,this.currentTime>=this.duration&&(this.currentTime=0)}}const x=(i=0)=>({duration:400,frames:[{time:0,frame:i}]}),v=(i=0)=>({duration:400,frames:[{time:0,frame:i+1},{time:100,frame:i},{time:200,frame:i+1},{time:300,frame:i+2}]}),M=x(1),U=x(7),k=x(4),b=x(10),E=v(0),_=v(6),q=v(3),C=v(9);class G{constructor(e){this.patterens=e,this.activateKey=Object.keys(this.patterens)[0]}play(e,t=0){this.activateKey!==e&&(this.activateKey=e,this.patterens[this.activateKey].currentTime=t)}get frame(){return this.patterens[this.activateKey].frame}step(e){this.patterens[this.activateKey].step(e)}}const X=document.querySelector("#game-canvas"),g=X.getContext("2d");let f=p;const Y=new S({resource:L.images.sky,frameSize:new c(320,180)}),H=new S({resource:L.images.ground,frameSize:new c(320,180)}),j=new S({resource:L.images.shadow,frameSize:new c(32,32)}),a=new S({resource:L.images.hero,frameSize:new c(32,32),hframe:3,vframe:8,frame:1,position:new c(K(6),K(5)),animations:new G({walkDown:new h(E),walkUp:new h(_),walkRight:new h(q),walkLeft:new h(C),standDown:new h(M),standUp:new h(U),standRight:new h(k),standLeft:new h(b)})}),u=a.position.duplicate(),P=new c(-8,-21),$=()=>{const i=a.position.x+P.x,e=a.position.y+1+P.y;Y.drawImage(g,0,0),H.drawImage(g,0,0),j.drawImage(g,i,e),a.drawImage(g,i,e)},l=new z,V=i=>{N(a,u,1)<=1&&B(),a.step(i)},B=()=>{if(f=l.direction??f,!l.direction){f===y&&a.animations.play("standLeft"),f===T&&a.animations.play("standUp"),f===p&&a.animations.play("standDown"),f===A&&a.animations.play("standRight");return}let i=u.x,e=u.y;const t=16;l.direction===p&&(e+=t,a.animations.play("walkDown")),l.direction===T&&(e-=t,a.animations.play("walkUp")),l.direction===A&&(i+=t,a.animations.play("walkRight")),l.direction===y&&(i-=t,a.animations.play("walkLeft")),W(d,i,e)&&(u.x=i,u.y=e)},J=new F(V,$);J.start();
